@model List<IFormFile>
@{
    ViewData["Title"] = "Register";
    // Layout = "~/Views/Shared/_Layout.cshtml";
    Layout = null;
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/2.3.0/alpine.js"></script>
<script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js" defer></script>


<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center justify-center px-6 sm:px-11 py-8 sm:py-16">
    <div class="max-w-full sm:max-w-6xl mx-auto px-6 sm:px-11 py-8 sm:py-17">
        <div class="text-center">
            <h1 class="text-3xl sm:text-5xl font-bold text-gray-900 mb-6">Upload & Share Instantly</h1>
            <p class="text-lg sm:text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
                Share any type of file securely. No registration required.
            </p>
        </div>

        <div x-data="fileUpload()" class="mt-8 max-w-full sm:max-w-2xl mx-auto">
            <form asp-controller="Upload" asp-action="ProcessUpload" method="post" enctype="multipart/form-data" class="relative">

                <!-- File Upload Section -->
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-2 border-dashed border-gray-300 hover:border-indigo-400 transition"
                     x-bind:class="{ 'border-indigo-600': isDragging }"
                     x-on:dragover.prevent="isDragging = true"
                     x-on:dragleave.prevent="isDragging = false"
                     x-on:drop.prevent="dropFiles($event)">

                    <!-- Upload Icon -->
                    <div class="text-center" x-show="!hasFiles">
                        <svg class="mx-auto h-12 w-12 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="mt-4 text-lg text-gray-600">Drag and drop your files here or</p>
                        <button type="button" class="mt-2 text-indigo-600 hover:text-indigo-700 font-medium"
                                x-on:click="$refs.fileInput.click()">
                            browse to choose files
                        </button>
                    </div>

                    <!-- File List -->
                    <div x-show="hasFiles" class="space-y-4">
                        <template x-for="(file, index) in files" :key="index">
                            <div class="flex items-center justify-between bg-gray-50 p-4 rounded-lg">
                                <div class="flex items-center space-x-4">
                                    <svg class="h-6 w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900" x-text="file.name"></p>
                                        <p class="text-sm text-gray-500" x-text="formatFileSize(file.size)"></p>
                                    </div>
                                </div>
                                <button type="button" class="text-red-600 hover:text-red-800" x-on:click="removeFile(index)">
                                    Remove
                                </button>
                            </div>
                        </template>

                        <div class="flex flex-col sm:flex-row justify-between sm:space-x-4 mt-4">
                            <button type="button" class="px-4 py-2 text-gray-700 hover:text-gray-900 sm:mb-0 mb-4"
                                    x-on:click="clearFiles">
                                Clear All
                            </button>
                            <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                Upload Files
                            </button>
                        </div>
                    </div>

                    <input type="file"
                           multiple
                           class="hidden"
                           x-ref="fileInput"
                           x-on:change="handleFiles"
                           accept="*/*">
                </div>

                <!-- Mobile Number Section -->
                <div class="mt-8">
                    <label for="showMobile" class="inline-flex items-center">
                        <input type="checkbox" id="showMobile" x-model="showMobile" class="form-checkbox h-5 w-5 text-indigo-600">
                        <span class="ml-2 text-gray-700">If you'd like, you can provide your mobile number for tracking purposes &nbsp;</span>
                        <i class="fas fa-info-circle text-blue-500" x-on:mouseenter="showTooltip = true" x-on:mouseleave="showTooltip = false"></i>
                    </label>

                    <!-- Tooltip with Instructions -->
                    <div x-show="showTooltip" class="absolute bg-gray-800 text-white text-sm p-4 rounded-lg shadow-lg max-w-sm mt-2 w-full z-10">
                        <p><strong>Anonymous Upload:</strong> You can upload files without providing any personal information.</p>
                        <p><strong>Optional Mobile Number:</strong> If you'd like to include your mobile number for tracking purposes, you can do so by checking the box below. This is entirely optional.</p>
                    </div>

                    <!-- Mobile Number Input (only visible if checkbox is checked) -->
                    <div x-show="showMobile" class="mt-4">
                        <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                        <input type="tel" id="mobile" name="mobile" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your mobile number" required>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-center mt-6">
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        Upload Files
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function fileUpload() {
        return {
            isDragging: false,
            files: [],
            hasFiles: false,
            isUploading: false,
            progress: 0,
            showMobile: false,  // Tracks whether the mobile number field is visible or not
            showTooltip: false, // Controls the visibility of the tooltip

            dropFiles(event) {
                this.isDragging = false;
                this.addFiles(event.dataTransfer.files);
            },

            handleFiles() {
                this.addFiles(this.$refs.fileInput.files);
            },

            addFiles(fileList) {
                Array.from(fileList).forEach(file => {
                    this.files.push(file);
                });
                this.hasFiles = this.files.length > 0;
            },

            removeFile(index) {
                this.files.splice(index, 1);
                this.hasFiles = this.files.length > 0;
            },

            clearFiles() {
                this.files = [];
                this.hasFiles = false;
            },

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }
    }
</script>
